name: Dispatched
on:
  push:
    paths:
      - ".github/workflows/on-dispatch.yml"
  workflow_dispatch:
  workflow_call:
    

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - env:
          EVENT: ${{ toJson(github.event) }}
        run: echo $EVENT
  dispatch:
    runs-on: ubuntu-latest
    permissions: "write-all"
    steps:
      - env:
          ACCEPT_HEADER: "Accept: application/vnd.github+json"
          AUTH_HEADER: "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}"
          JSON_CONTENT: '{"event_type":"dispatch","client_payload":{"package_name": "${{ vars.PACKAGE_NAME }}"}}'
        run: curl -L -X POST -H "$ACCEPT_HEADER" -H "$AUTH_HEADER" https://api.github.com/repos/alexxss/satis-github/dispatches -d "$JSON_CONTENT"
